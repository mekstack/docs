# Magnum ca-rotate положил продуктовый K8s

## Описание

**Date:** 13.12.2023

**Authors:** mmskv, thehussky

**Status:** Решён

**Summary:** Продуктовый K8s кластер лежал 6 часов из-за неудачной ротации корневых сертификатов Kube API.

**Impact:** Один пользователь не смог авторизоваться в облаке.

**Root Causes:**

**Trigger:** Запуск обновления корневых сертификатов в Magnum.

**Resolution:** Редеплойнули кластер и восстановили данные из сохранившихся pvc.

**Detection:** Во время ротации сертификатов заметили, что кластер долго не вставал.

**Action Items:**

| **Action**                                                                              | **Type** | **Owner** | **Github Issue** |
| --------------------------------------------------------------------------------------- | -------- | --------- | ---------------- |
| Написать скрипты и инструкцию для восстановления данных на новом кластере из старых pvc | mitigate | thehussky | n/a, **TODO**    |
| Разочаровались в magnum и перешли на самописный деплоер                                 | prevent  | mmskv     | n/a, **DONE**    |
| Добавили сценарии отказа нод K8s в программу тестирования высокодоступности             | process  | mmskv     | n/a, **TODO**    |

## Жизненные уроки

#### Что пошло по плану

- TODO
- TODO

#### Что пошло не по плану

- TODO
- TODO

#### В чем повезло

- Cinder-CSI не удалил pvc cinder вольюмы, поэтому все данные сохранились
- TODO

## Таймлайн

13.12.2023

- 14:51 TODO
- 14:53 TODO
